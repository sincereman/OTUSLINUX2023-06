# Ğ”Ğ¾Ğ¼Ğ°ÑˆĞ½ĞµĞµ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ğµ
## ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°

### Ğ¦ĞµĞ»ÑŒ:
Ğ½Ğ°ÑƒÑ‡Ğ¸Ñ‚ÑŒÑÑ Ğ½Ğ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°Ñ‚ÑŒ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´;


### ĞĞ¿Ğ¸ÑĞ°Ğ½Ğ¸Ğµ/ĞŸĞ¾ÑˆĞ°Ğ³Ğ¾Ğ²Ğ°Ñ Ğ¸Ğ½ÑÑ‚Ñ€ÑƒĞºÑ†Ğ¸Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ¾Ğ¼Ğ°ÑˆĞ½ĞµĞ³Ğ¾ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ:
Ğ§Ñ‚Ğ¾ Ğ½ÑƒĞ¶Ğ½Ğ¾ ÑĞ´ĞµĞ»Ğ°Ñ‚ÑŒ?
ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Ñ 4-Ğ¼Ñ Ğ³Ñ€Ğ°Ñ„Ğ¸ĞºĞ°Ğ¼Ğ¸

Ğ¿Ğ°Ğ¼ÑÑ‚ÑŒ;
Ğ¿Ñ€Ğ¾Ñ†ĞµÑÑĞ¾Ñ€;
Ğ´Ğ¸ÑĞº;
ÑĞµÑ‚ÑŒ.
ĞĞ°ÑÑ‚Ñ€Ğ¾Ğ¸Ñ‚ÑŒ Ğ½Ğ° Ğ¾Ğ´Ğ½Ğ¾Ğ¹ Ğ¸Ğ· ÑĞ¸ÑÑ‚ĞµĞ¼:
zabbix (Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ screen (ĞºĞ¾Ğ¼Ğ¿Ğ»ĞµĞºÑĞ½Ñ‹Ğ¹ ÑĞºÑ€Ğ°Ğ½);
prometheus - grafana.
Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ ÑĞ¸ÑÑ‚ĞµĞ¼, Ğ¿Ñ€Ğ¸Ğ¼ĞµÑ€Ñ‹ ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ñ… Ğ½Ğµ Ñ€Ğ°ÑÑĞ¼Ğ°Ñ‚Ñ€Ğ¸Ğ²Ğ°Ğ»Ğ¸ÑÑŒ Ğ½Ğ° Ğ·Ğ°Ğ½ÑÑ‚Ğ¸Ğ¸*
Ğ¡Ğ¿Ğ¸ÑĞ¾Ğº Ğ²Ğ¾Ğ·Ğ¼Ğ¾Ğ¶Ğ½Ñ‹Ñ… ÑĞ¸ÑÑ‚ĞµĞ¼ Ğ±Ñ‹Ğ» Ğ¿Ñ€Ğ¸Ğ²ĞµĞ´ĞµĞ½ Ğ² Ğ¿Ñ€ĞµĞ·ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ğ¸.
Ğ’ ĞºĞ°Ñ‡ĞµÑÑ‚Ğ²Ğµ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğ° Ğ¿Ñ€Ğ¸ÑĞ»Ğ°Ñ‚ÑŒ ÑĞºÑ€Ğ¸Ğ½ÑˆĞ¾Ñ‚ ÑĞºÑ€Ğ°Ğ½Ğ° - Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´ Ğ´Ğ¾Ğ»Ğ¶ĞµĞ½ ÑĞ¾Ğ´ĞµÑ€Ğ¶Ğ°Ñ‚ÑŒ Ğ² Ğ½Ğ°Ğ·Ğ²Ğ°Ğ½Ğ¸Ğ¸ Ğ¸Ğ¼Ñ Ğ¿Ñ€Ğ¸ÑĞ»Ğ°Ğ²ÑˆĞµĞ³Ğ¾.

# Ğ¥Ğ¾Ğ´ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ´Ğ¾Ğ¼Ğ°ÑˆĞ½ĞµĞ³Ğ¾ Ğ·Ğ°Ğ´Ğ°Ğ½Ğ¸Ñ


Ğ”Ğ»Ñ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ Ğ”Ğ— Ğ²Ñ‹Ğ±Ğ¸Ñ€Ğ°Ñ Prometheus, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ñ Zabbix Ğ·Ğ½Ğ°ĞºĞ¾Ğ¼ Ğ±Ğ¾Ğ»ÑŒÑˆĞµ.


Ğ”Ğ»Ñ Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸Ñ Ğ¸ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ¸ Ğ»Ğ°Ğ±Ğ¾Ñ€Ğ°Ñ‚Ğ¾Ñ€Ğ½Ğ¾Ğ³Ğ¾ Ğ¾ĞºÑ€ÑƒĞ¶ĞµĞ½Ğ¸Ñ Ğ±ÑƒĞ´ĞµĞ¼ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ vagrant Ğ¸ ansible


Ğ¢Ğ°Ğº ĞºĞ°Ğº Ğ·Ğ°Ğ´Ğ°Ñ‡Ğ° Ğ´Ğ¾Ğ²Ğ¾Ğ»ÑŒĞ½Ğ° Ğ±Ğ¾Ğ»ÑŒÑˆĞ°Ñ, Ğ±ÑƒĞ´ĞµĞ¼ ĞµÑÑ‚ÑŒ ÑĞ»Ğ¾Ğ½Ğ° Ğ¿Ğ¾ Ñ‡Ğ°ÑÑ‚ÑĞ¼ Ğ¸ Ğ¸ÑĞ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒ Ñ‡ÑƒĞ¶Ğ¾Ğ¹ Ğ¾Ğ¿Ñ‹Ñ‚.

1. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ´Ğ¸Ğ¼ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ vm  Ğ´Ğ»Ñ ĞºĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ğ¸ Vagrantfile Ğ¸ ÑĞ°Ğ¼ Ñ„Ğ°Ğ¹Ğ»


```shell

mkdir vm && cd vm

vagrant init

# Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Vagrantfile - ÑĞ¾Ğ·Ğ´Ğ°ÑÑ‚ ÑĞµÑ€Ğ²ĞµÑ€ (Ğ´Ğ»Ñ prometheus Ğ¸ Ğ´Ğ²Ğ° Ñ…Ğ¾ÑÑ‚Ğ° ĞºĞ¾Ñ‚Ğ¾Ñ€Ñ‹Ğµ Ğ±ÑƒĞ´ĞµĞ¼ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ‚ÑŒ)

# -*- mode: ruby -*-
# vim: set ft=ruby :
node_list = [
    { :host => "server", :box => "centos/8",
        :gui => false, :ip => "192.168.56.10" , :cpu => 2 ,:ram => 2028 },
    { :host => "client1-nodeexporters", :box => "centos/8",
        :gui => false, :ip => "192.168.56.11" , :cpu => 1 ,:ram => 1024 },
    { :host => "client2-nodeexporters", :box => "centos/8",
        :gui => false, :ip => "192.168.56.12" , :cpu => 1 ,:ram => 1024 },
]


Vagrant.configure("2") do |config|


    node_list.each do |node|


        config.vm.define node[:host] do |node_config|


            node_config.vm.box = node[:box]


            node_config.vm.network "private_network", ip: node[:ip], :netmask => "255.255.255.0"
            node_config.vm.hostname = "#{node[:host]}"
            node_config.vm.provider :virtualbox do |v|
                v.name = node[:host].to_s


                v.customize ["modifyvm", :id, "--memory", node[:ram].to_s]
                v.customize ["modifyvm", :id, "--cpus", node[:cpu].to_s]
            end
            node_config.vm.provision "shell", inline: <<-SHELL
            mkdir -p ~root/.ssh; cp ~vagrant/.ssh/auth* ~root/.ssh
            sed -i '65s/PasswordAuthentication no/PasswordAuthentication yes/g' /etc/ssh/sshd_config
            systemctl restart sshd
          SHELL
        end
    end
end


```
<details> 
<summary> ĞŸÑ€Ğ¾Ñ†ĞµÑÑ ÑĞ¾Ğ·Ğ´Ğ°Ğ½Ğ¸Ñ VM</summary>

sincere@sincere-ubuntuotus:~/vagrantdocs/lesson21/vm$ vagrant up
Bringing machine 'server' up with 'virtualbox' provider...
Bringing machine 'client1-nodeexporters' up with 'virtualbox' provider...
Bringing machine 'client2-nodeexporters' up with 'virtualbox' provider...
==> server: Importing base box 'centos/8'...
==> server: Matching MAC address for NAT networking...
==> server: Checking if box 'centos/8' version '2011.0' is up to date...
==> server: Setting the name of the VM: server
==> server: Fixed port collision for 22 => 2222. Now on port 2200.
==> server: Clearing any previously set network interfaces...
==> server: Preparing network interfaces based on configuration...
    server: Adapter 1: nat
    server: Adapter 2: hostonly
==> server: Forwarding ports...
    server: 22 (guest) => 2200 (host) (adapter 1)
==> server: Running 'pre-boot' VM customizations...
==> server: Booting VM...
==> server: Waiting for machine to boot. This may take a few minutes...
    server: SSH address: 127.0.0.1:2200
    server: SSH username: vagrant
    server: SSH auth method: private key
    server: 
    server: Vagrant insecure key detected. Vagrant will automatically replace
    server: this with a newly generated keypair for better security.
    server: 
    server: Inserting generated public key within guest...
    server: Removing insecure key from the guest if it's present...
    server: Key inserted! Disconnecting and reconnecting using new SSH key...
==> server: Machine booted and ready!
==> server: Checking for guest additions in VM...
    server: No guest additions were detected on the base box for this VM! Guest
    server: additions are required for forwarded ports, shared folders, host only
    server: networking, and more. If SSH fails on this machine, please install
    server: the guest additions and repackage the box to continue.
    server: 
    server: This is not an error message; everything may continue to work properly,
    server: in which case you may ignore this message.
==> server: Setting hostname...
==> server: Configuring and enabling network interfaces...
==> server: Rsyncing folder: /home/sincere/vagrantdocs/lesson21/vm/ => /vagrant
==> server: Running provisioner: shell...
    server: Running: inline script
==> client1-nodeexporters: Importing base box 'centos/8'...
==> client1-nodeexporters: Matching MAC address for NAT networking...
==> client1-nodeexporters: Checking if box 'centos/8' version '2011.0' is up to date...
==> client1-nodeexporters: Setting the name of the VM: client1-nodeexporters
==> client1-nodeexporters: Fixed port collision for 22 => 2222. Now on port 2201.
==> client1-nodeexporters: Clearing any previously set network interfaces...
==> client1-nodeexporters: Preparing network interfaces based on configuration...
    client1-nodeexporters: Adapter 1: nat
    client1-nodeexporters: Adapter 2: hostonly
==> client1-nodeexporters: Forwarding ports...
    client1-nodeexporters: 22 (guest) => 2201 (host) (adapter 1)
==> client1-nodeexporters: Running 'pre-boot' VM customizations...
==> client1-nodeexporters: Booting VM...
==> client1-nodeexporters: Waiting for machine to boot. This may take a few minutes...
    client1-nodeexporters: SSH address: 127.0.0.1:2201
    client1-nodeexporters: SSH username: vagrant
    client1-nodeexporters: SSH auth method: private key
    client1-nodeexporters: 
    client1-nodeexporters: Vagrant insecure key detected. Vagrant will automatically replace
    client1-nodeexporters: this with a newly generated keypair for better security.
    client1-nodeexporters: 
    client1-nodeexporters: Inserting generated public key within guest...
    client1-nodeexporters: Removing insecure key from the guest if it's present...
    client1-nodeexporters: Key inserted! Disconnecting and reconnecting using new SSH key...
==> client1-nodeexporters: Machine booted and ready!
==> client1-nodeexporters: Checking for guest additions in VM...
    client1-nodeexporters: No guest additions were detected on the base box for this VM! Guest
    client1-nodeexporters: additions are required for forwarded ports, shared folders, host only
    client1-nodeexporters: networking, and more. If SSH fails on this machine, please install
    client1-nodeexporters: the guest additions and repackage the box to continue.
    client1-nodeexporters: 
    client1-nodeexporters: This is not an error message; everything may continue to work properly,
    client1-nodeexporters: in which case you may ignore this message.
==> client1-nodeexporters: Setting hostname...
==> client1-nodeexporters: Configuring and enabling network interfaces...
==> client1-nodeexporters: Rsyncing folder: /home/sincere/vagrantdocs/lesson21/vm/ => /vagrant
==> client1-nodeexporters: Running provisioner: shell...
    client1-nodeexporters: Running: inline script
==> client2-nodeexporters: Importing base box 'centos/8'...
==> client2-nodeexporters: Matching MAC address for NAT networking...
==> client2-nodeexporters: Checking if box 'centos/8' version '2011.0' is up to date...
==> client2-nodeexporters: Setting the name of the VM: client2-nodeexporters
==> client2-nodeexporters: Fixed port collision for 22 => 2222. Now on port 2202.
==> client2-nodeexporters: Clearing any previously set network interfaces...
==> client2-nodeexporters: Preparing network interfaces based on configuration...
    client2-nodeexporters: Adapter 1: nat
    client2-nodeexporters: Adapter 2: hostonly
==> client2-nodeexporters: Forwarding ports...
    client2-nodeexporters: 22 (guest) => 2202 (host) (adapter 1)
==> client2-nodeexporters: Running 'pre-boot' VM customizations...
==> client2-nodeexporters: Booting VM...
==> client2-nodeexporters: Waiting for machine to boot. This may take a few minutes...
    client2-nodeexporters: SSH address: 127.0.0.1:2202
    client2-nodeexporters: SSH username: vagrant
    client2-nodeexporters: SSH auth method: private key
    client2-nodeexporters: 
    client2-nodeexporters: Vagrant insecure key detected. Vagrant will automatically replace
    client2-nodeexporters: this with a newly generated keypair for better security.
    client2-nodeexporters: 
    client2-nodeexporters: Inserting generated public key within guest...
    client2-nodeexporters: Removing insecure key from the guest if it's present...
    client2-nodeexporters: Key inserted! Disconnecting and reconnecting using new SSH key...
==> client2-nodeexporters: Machine booted and ready!
==> client2-nodeexporters: Checking for guest additions in VM...
    client2-nodeexporters: No guest additions were detected on the base box for this VM! Guest
    client2-nodeexporters: additions are required for forwarded ports, shared folders, host only
    client2-nodeexporters: networking, and more. If SSH fails on this machine, please install
    client2-nodeexporters: the guest additions and repackage the box to continue.
    client2-nodeexporters: 
    client2-nodeexporters: This is not an error message; everything may continue to work properly,
    client2-nodeexporters: in which case you may ignore this message.
==> client2-nodeexporters: Setting hostname...
==> client2-nodeexporters: Configuring and enabling network interfaces...
==> client2-nodeexporters: Rsyncing folder: /home/sincere/vagrantdocs/lesson21/vm/ => /vagrant
==> client2-nodeexporters: Running provisioner: shell...
    client2-nodeexporters: Running: inline script

</details>


ĞŸÑ€Ğ¾Ğ²ĞµÑ€Ğ¸Ğ¼ Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ Ğ¿Ğ¾Ğ´ĞºĞ»ÑÑ‡ĞµĞ½Ğ¸Ñ


```shell
sincere@sincere-ubuntuotus:~/vagrantdocs/lesson21/vm$ VBoxManage list vms
"server" {cded0580-2421-4726-83b8-348ebc19219a}
"client1-nodeexporters" {1a48638d-0ea2-4ece-84cb-0ec306c18cb6}
"client2-nodeexporters" {57dc728e-691f-4789-96ed-baf9f4d87943}

sincere@sincere-ubuntuotus:~/vagrantdocs/lesson21/vm$ vagrant ssh server
[vagrant@server ~]$ uname -a
Linux server 4.18.0-240.1.1.el8_3.x86_64 #1 SMP Thu Nov 19 17:20:08 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
[vagrant@server ~]$ 

sincere@sincere-ubuntuotus:~/vagrantdocs/lesson21/vm$ vagrant ssh client1-nodeexporters
[vagrant@client1-nodeexporters ~]$ uname -a
Linux client1-nodeexporters 4.18.0-240.1.1.el8_3.x86_64 #1 SMP Thu Nov 19 17:20:08 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
[vagrant@client1-nodeexporters ~]$ ping ya.ru
PING ya.ru (5.255.255.242) 56(84) bytes of data.
64 bytes from ya.ru (5.255.255.242): icmp_seq=1 ttl=63 time=95.8 ms
^C
--- ya.ru ping statistics ---
1 packets transmitted, 1 received, 0% packet loss, time 0ms
rtt min/avg/max/mdev = 95.791/95.791/95.791/0.000 ms


sincere@sincere-ubuntuotus:~/vagrantdocs/lesson21/vm$ vagrant ssh client2-nodeexporters
[vagrant@client2-nodeexporters ~]$ uname -a
Linux client2-nodeexporters 4.18.0-240.1.1.el8_3.x86_64 #1 SMP Thu Nov 19 17:20:08 UTC 2020 x86_64 x86_64 x86_64 GNU/Linux
[vagrant@client2-nodeexporters ~]$ exit
logout
Connection to 127.0.0.1 closed.



```

Ğ’ÑĞµ vm Ğ´Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ñ‹ Ğ¸ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹ Ğº Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞµ


2. Ğ¡Ğ¾Ğ·Ğ´Ğ°Ğ´Ğ¸Ğ¼ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³ ansible

```shell

mkdir ansible &&  mkdir inventories

touch hosts


# Ğ¡Ğ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° hosts

[server]
server-prometheus ansible_host=192.168.56.10 ansible_port=22 ansible_user=vagrant ansible_private_key_file=../vm/.vagrant/machines/server/virtualbox/private_key

[client]
client1-nodeexporters ansible_host=192.168.56.11 ansible_private_key_file=../vm/.vagrant/machines/client1-nodeexporters/virtualbox/private_key
client2-nodeexporters ansible_host=192.168.56.12 ansible_private_key_file=../vm/.vagrant/machines/client2-nodeexporters/virtualbox/private_key

[client:vars]
ansible_user=vagrant
ansible_port=22
#ansible_ssh_private_key_file=/home/sincere/vagrantdocs/lesson21/vm/.vagrant/machines/server/virtualbox/private_key

# CĞ¾Ğ´ĞµÑ€Ğ¶Ğ¸Ğ¼Ğ¾Ğµ Ñ„Ğ°Ğ¹Ğ»Ğ° ansible.cfg

[defaults]
inventory = inventories/hosts
remote_user = vagrant
host_key_checking = False
retry_files_enabled = False
deprecation_warnings = False

# ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ°

sincere@sincere-ubuntuotus:~/vagrantdocs/lesson21/ansible$ ansible-inventory --list
{
    "_meta": {
        "hostvars": {
            "client1-nodeexporters": {
                "ansible_host": "192.168.56.11",
                "ansible_port": 22,
                "ansible_private_key_file": "../vm/.vagrant/machines/client1-nodeexporters/virtualbox/private_key",
                "ansible_user": "vagrant"
            },
            "client2-nodeexporters": {
                "ansible_host": "192.168.56.12",
                "ansible_port": 22,
                "ansible_private_key_file": "../vm/.vagrant/machines/client2-nodeexporters/virtualbox/private_key",
                "ansible_user": "vagrant"
            },
            "server-prometheus": {
                "ansible_host": "192.168.56.10",
                "ansible_port": 22,
                "ansible_private_key_file": "../vm/.vagrant/machines/server-prometheus/virtualbox/private_key",
                "ansible_user": "vagrant"
            }
        }
    },
    "all": {
        "children": [
            "client",
            "server",
            "ungrouped"
        ]
    },
    "client": {
        "hosts": [
            "client1-nodeexporters",
            "client2-nodeexporters"
        ]
    },
    "server": {
        "hosts": [
            "server-prometheus"
        ]
    }
}

sincere@sincere-ubuntuotus:~/vagrantdocs/lesson21/ansible$ ansible all -m ping
client1-nodeexporters | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": false,
    "ping": "pong"
}
client2-nodeexporters | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": false,
    "ping": "pong"
}
server-prometheus | SUCCESS => {
    "ansible_facts": {
        "discovered_interpreter_python": "/usr/libexec/platform-python"
    },
    "changed": false,
    "ping": "pong"
}



```

ĞĞ°ÑˆĞ¸ Ğ¼Ğ°ÑˆĞ¸Ğ½ĞºĞ¸ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ñ‹ Ğº Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞµ.


ĞŸĞ¾Ğ´Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¸Ğ¼ playbook

ĞŸĞ¾ĞºĞ°Ğ¶Ñƒ Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñƒ Ğ¸ ĞºĞ°Ğº Ğ¿Ğ¾Ğ»ÑŒĞ·Ğ¾Ğ²Ğ°Ñ‚ÑŒÑÑ

Ğ² ĞºĞ¾Ñ€ĞµĞ½Ğ²Ğ¾Ğ¼ ĞºĞ°Ñ‚Ğ°Ğ»Ğ¾Ğ³Ğµ Ğ»ĞµĞ¶Ğ¸Ñ‚ Ñ„Ğ°Ğ¹Ğ» main.sh - ĞºĞ°Ğº ĞºĞ»ÑÑ‡ Ğº Ğ¿Ğ¾Ğ»Ğ½Ğ¾Ñ†ĞµĞ½Ğ½Ğ¾Ğ¹ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞµ Ğ¸ Ğ¿Ñ€Ğ¾Ğ²Ğ¸Ğ¶Ğ½Ğ¸Ğ½Ğ³Ñƒ

Ğ¡Ğ¾Ğ·Ğ½Ğ°Ñ‚ĞµĞ»ÑŒĞ½Ğ¾ Ñ€Ğ°Ğ·Ğ´ĞµĞ»Ğ¸Ğ» vagrant Ğ¸ Ğ·Ğ°Ğ¿ÑƒÑĞº Ğ¿Ñ€Ğ¾Ğ²Ğ¸Ğ¶Ğ½Ğ¸Ğ½Ğ³Ğ°, Ñ‚Ğ°Ğº ĞºĞ°Ğº Ğ² Ñ‚Ğ°ĞºĞ¾Ğ¼ Ğ¾Ğ±ÑŠĞµĞ¼Ğµ ÑĞ¾Ğ±Ğ¸Ñ€Ğ°Ğ» Ğ¿ĞµÑ€Ğ²Ñ‹Ğ¹ Ñ€Ğ°Ğ· Ğ¸ Ñ‚Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ»Ğ¾ÑÑŒ Ğ¼Ğ½Ğ¾Ğ³Ğ¾ Ğ²Ñ€ĞµĞ¼ĞµĞ½Ğ¸ Ğ´Ğ»Ñ Ğ¾Ñ‚Ğ»Ğ°Ğ´ĞºĞ¸


<details><summary>Ğ¥Ğ¾Ğ´ Ğ²Ñ‹Ğ¿Ğ¾Ğ»Ğ½ĞµĞ½Ğ¸Ñ ÑĞºÑ€Ğ¸Ğ¿Ñ‚Ğ°</summary></details>

prometheus-2.47.0.linux-amd64/
prometheus-2.47.0.linux-amd64/console_libraries/
prometheus-2.47.0.linux-amd64/console_libraries/menu.lib
prometheus-2.47.0.linux-amd64/console_libraries/prom.lib
prometheus-2.47.0.linux-amd64/prometheus.yml
prometheus-2.47.0.linux-amd64/promtool
prometheus-2.47.0.linux-amd64/LICENSE
prometheus-2.47.0.linux-amd64/prometheus
prometheus-2.47.0.linux-amd64/NOTICE
prometheus-2.47.0.linux-amd64/consoles/
prometheus-2.47.0.linux-amd64/consoles/prometheus-overview.html
prometheus-2.47.0.linux-amd64/consoles/node.html
prometheus-2.47.0.linux-amd64/consoles/node-cpu.html
prometheus-2.47.0.linux-amd64/consoles/index.html.example
prometheus-2.47.0.linux-amd64/consoles/prometheus.html
prometheus-2.47.0.linux-amd64/consoles/node-overview.html
prometheus-2.47.0.linux-amd64/consoles/node-disk.html
node_exporter-1.6.1.linux-amd64/
node_exporter-1.6.1.linux-amd64/NOTICE
node_exporter-1.6.1.linux-amd64/node_exporter
node_exporter-1.6.1.linux-amd64/LICENSE
Bringing machine 'server-prometheus' up with 'virtualbox' provider...
Bringing machine 'client1-nodeexporters' up with 'virtualbox' provider...
Bringing machine 'client2-nodeexporters' up with 'virtualbox' provider...
==> server-prometheus: Importing base box 'centos/8'...

[KProgress: 20%
[KProgress: 40%
[KProgress: 50%
[KProgress: 70%
[KProgress: 90%
[K==> server-prometheus: Matching MAC address for NAT networking...
==> server-prometheus: Checking if box 'centos/8' version '2011.0' is up to date...
==> server-prometheus: Setting the name of the VM: server-prometheus
==> server-prometheus: Clearing any previously set network interfaces...
==> server-prometheus: Preparing network interfaces based on configuration...
    server-prometheus: Adapter 1: nat
    server-prometheus: Adapter 2: hostonly
==> server-prometheus: Forwarding ports...
    server-prometheus: 22 (guest) => 2222 (host) (adapter 1)
==> server-prometheus: Running 'pre-boot' VM customizations...
==> server-prometheus: Booting VM...
==> server-prometheus: Waiting for machine to boot. This may take a few minutes...
    server-prometheus: SSH address: 127.0.0.1:2222
    server-prometheus: SSH username: vagrant
    server-prometheus: SSH auth method: private key
    server-prometheus: 
    server-prometheus: Vagrant insecure key detected. Vagrant will automatically replace
    server-prometheus: this with a newly generated keypair for better security.
    server-prometheus: 
    server-prometheus: Inserting generated public key within guest...
    server-prometheus: Removing insecure key from the guest if it's present...
    server-prometheus: Key inserted! Disconnecting and reconnecting using new SSH key...
==> server-prometheus: Machine booted and ready!
==> server-prometheus: Checking for guest additions in VM...
    server-prometheus: No guest additions were detected on the base box for this VM! Guest
    server-prometheus: additions are required for forwarded ports, shared folders, host only
    server-prometheus: networking, and more. If SSH fails on this machine, please install
    server-prometheus: the guest additions and repackage the box to continue.
    server-prometheus: 
    server-prometheus: This is not an error message; everything may continue to work properly,
    server-prometheus: in which case you may ignore this message.
==> server-prometheus: Setting hostname...
==> server-prometheus: Configuring and enabling network interfaces...
==> server-prometheus: Rsyncing folder: /home/sincere/vagrantdocs/lesson21/vm/ => /vagrant
==> server-prometheus: Running provisioner: shell...
    server-prometheus: Running: inline script
==> client1-nodeexporters: Importing base box 'centos/8'...

[KProgress: 20%
[KProgress: 40%
[KProgress: 50%
[KProgress: 70%
[KProgress: 90%
[K==> client1-nodeexporters: Matching MAC address for NAT networking...
==> client1-nodeexporters: Checking if box 'centos/8' version '2011.0' is up to date...
==> client1-nodeexporters: Setting the name of the VM: client1-nodeexporters
==> client1-nodeexporters: Fixed port collision for 22 => 2222. Now on port 2200.
==> client1-nodeexporters: Clearing any previously set network interfaces...
==> client1-nodeexporters: Preparing network interfaces based on configuration...
    client1-nodeexporters: Adapter 1: nat
    client1-nodeexporters: Adapter 2: hostonly
==> client1-nodeexporters: Forwarding ports...
    client1-nodeexporters: 22 (guest) => 2200 (host) (adapter 1)
==> client1-nodeexporters: Running 'pre-boot' VM customizations...
==> client1-nodeexporters: Booting VM...
==> client1-nodeexporters: Waiting for machine to boot. This may take a few minutes...
    client1-nodeexporters: SSH address: 127.0.0.1:2200
    client1-nodeexporters: SSH username: vagrant
    client1-nodeexporters: SSH auth method: private key
    client1-nodeexporters: 
    client1-nodeexporters: Vagrant insecure key detected. Vagrant will automatically replace
    client1-nodeexporters: this with a newly generated keypair for better security.
    client1-nodeexporters: 
    client1-nodeexporters: Inserting generated public key within guest...
    client1-nodeexporters: Removing insecure key from the guest if it's present...
    client1-nodeexporters: Key inserted! Disconnecting and reconnecting using new SSH key...
==> client1-nodeexporters: Machine booted and ready!
==> client1-nodeexporters: Checking for guest additions in VM...
    client1-nodeexporters: No guest additions were detected on the base box for this VM! Guest
    client1-nodeexporters: additions are required for forwarded ports, shared folders, host only
    client1-nodeexporters: networking, and more. If SSH fails on this machine, please install
    client1-nodeexporters: the guest additions and repackage the box to continue.
    client1-nodeexporters: 
    client1-nodeexporters: This is not an error message; everything may continue to work properly,
    client1-nodeexporters: in which case you may ignore this message.
==> client1-nodeexporters: Setting hostname...
==> client1-nodeexporters: Configuring and enabling network interfaces...
==> client1-nodeexporters: Rsyncing folder: /home/sincere/vagrantdocs/lesson21/vm/ => /vagrant
==> client1-nodeexporters: Running provisioner: shell...
    client1-nodeexporters: Running: inline script
==> client2-nodeexporters: Importing base box 'centos/8'...

[KProgress: 20%
[KProgress: 40%
[KProgress: 50%
[KProgress: 70%
[KProgress: 90%
[K==> client2-nodeexporters: Matching MAC address for NAT networking...
==> client2-nodeexporters: Checking if box 'centos/8' version '2011.0' is up to date...
==> client2-nodeexporters: Setting the name of the VM: client2-nodeexporters
==> client2-nodeexporters: Fixed port collision for 22 => 2222. Now on port 2201.
==> client2-nodeexporters: Clearing any previously set network interfaces...
==> client2-nodeexporters: Preparing network interfaces based on configuration...
    client2-nodeexporters: Adapter 1: nat
    client2-nodeexporters: Adapter 2: hostonly
==> client2-nodeexporters: Forwarding ports...
    client2-nodeexporters: 22 (guest) => 2201 (host) (adapter 1)
==> client2-nodeexporters: Running 'pre-boot' VM customizations...
==> client2-nodeexporters: Booting VM...
==> client2-nodeexporters: Waiting for machine to boot. This may take a few minutes...
    client2-nodeexporters: SSH address: 127.0.0.1:2201
    client2-nodeexporters: SSH username: vagrant
    client2-nodeexporters: SSH auth method: private key
    client2-nodeexporters: 
    client2-nodeexporters: Vagrant insecure key detected. Vagrant will automatically replace
    client2-nodeexporters: this with a newly generated keypair for better security.
    client2-nodeexporters: 
    client2-nodeexporters: Inserting generated public key within guest...
    client2-nodeexporters: Removing insecure key from the guest if it's present...
    client2-nodeexporters: Key inserted! Disconnecting and reconnecting using new SSH key...
==> client2-nodeexporters: Machine booted and ready!
==> client2-nodeexporters: Checking for guest additions in VM...
    client2-nodeexporters: No guest additions were detected on the base box for this VM! Guest
    client2-nodeexporters: additions are required for forwarded ports, shared folders, host only
    client2-nodeexporters: networking, and more. If SSH fails on this machine, please install
    client2-nodeexporters: the guest additions and repackage the box to continue.
    client2-nodeexporters: 
    client2-nodeexporters: This is not an error message; everything may continue to work properly,
    client2-nodeexporters: in which case you may ignore this message.
==> client2-nodeexporters: Setting hostname...
==> client2-nodeexporters: Configuring and enabling network interfaces...
==> client2-nodeexporters: Rsyncing folder: /home/sincere/vagrantdocs/lesson21/vm/ => /vagrant
==> client2-nodeexporters: Running provisioner: shell...
    client2-nodeexporters: Running: inline script

PLAY [Playbook of server (prometheus) initialization] ***************************************************************************************************************************

TASK [Gathering Facts] **********************************************************************************************************************************************************
ok: [server-prometheus]

TASK [../roles/server : Set time zone] ******************************************************************************************************************************************
changed: [server-prometheus]

TASK [../roles/server : Update Repo url] ****************************************************************************************************************************************
changed: [server-prometheus] => (item=sudo sed -i 's/mirrorlist/#mirrorlist/g' /etc/yum.repos.d/CentOS-*.repo)
changed: [server-prometheus] => (item=sudo sed -i 's|#baseurl=http://mirror.centos.org|baseurl=http://vault.centos.org|g' /etc/yum.repos.d/CentOS-*.repo)

TASK [../roles/server : Synchronize datetime | Install chrony] ******************************************************************************************************************
changed: [server-prometheus]

TASK [../roles/server : Synchronize datetime | Turn on chronyd] *****************************************************************************************************************
ok: [server-prometheus]

TASK [../roles/server : Create prometheus user] *********************************************************************************************************************************
changed: [server-prometheus]

TASK [../roles/server : Create new folders, set specific permission] ************************************************************************************************************
changed: [server-prometheus]

TASK [../roles/server : Copy ./prometheus to /usr/local/bin] ********************************************************************************************************************
changed: [server-prometheus]

TASK [../roles/server : Copy ./promtool to /usr/local/bin] **********************************************************************************************************************
changed: [server-prometheus]

TASK [../roles/server : Configure prometeus application | prometheus.yml] *******************************************************************************************************
changed: [server-prometheus]

TASK [../roles/server : Configure prometeus application | consoles] *************************************************************************************************************
changed: [server-prometheus]

TASK [../roles/server : Configure prometeus application | console libraries] ****************************************************************************************************
changed: [server-prometheus]

TASK [../roles/server : Configure prometeus application | consoles] *************************************************************************************************************
changed: [server-prometheus]

TASK [../roles/server : Configure prometeus service] ****************************************************************************************************************************
changed: [server-prometheus]

TASK [../roles/server : Turn on prometeus service] ******************************************************************************************************************************
changed: [server-prometheus]

TASK [../roles/server : Check http] *********************************************************************************************************************************************
ok: [server-prometheus]

TASK [../roles/server : Check http] *********************************************************************************************************************************************
skipping: [server-prometheus]

TASK [../roles/server : Create repo Grafana] ************************************************************************************************************************************
changed: [server-prometheus]

TASK [../roles/server : Install Grafana] ****************************************************************************************************************************************

PLAY [Playbook of client (node exporter) initialization] ************************************************************************************************************************

TASK [Gathering Facts] **********************************************************************************************************************************************************
ok: [client1-nodeexporters]
ok: [client2-nodeexporters]

TASK [../roles/client : Set time zone] ******************************************************************************************************************************************
changed: [client1-nodeexporters]
changed: [client2-nodeexporters]

TASK [../roles/client : Update Repo url from updatereposcript.sh] ***************************************************************************************************************
changed: [client1-nodeexporters]
changed: [client2-nodeexporters]

TASK [../roles/client : Synchronize datetime | Install chrony] ******************************************************************************************************************
changed: [client2-nodeexporters]
changed: [client1-nodeexporters]

TASK [../roles/client : Synchronize datetime | Turn on chronyd] *****************************************************************************************************************
ok: [client1-nodeexporters]
ok: [client2-nodeexporters]

TASK [../roles/client : Create node exporter user] ******************************************************************************************************************************
changed: [client1-nodeexporters]
changed: [client2-nodeexporters]

TASK [../roles/client : Create work paths] **************************************************************************************************************************************
changed: [client1-nodeexporters]
changed: [client2-nodeexporters]

TASK [../roles/client : Copy ./node_exporter to /usr/local/bin] *****************************************************************************************************************
changed: [client1-nodeexporters]
changed: [client2-nodeexporters]

TASK [../roles/client : Configure node exporter service] ************************************************************************************************************************
changed: [client1-nodeexporters]
changed: [client2-nodeexporters]

TASK [../roles/client : Turn on node_exporter service] **************************************************************************************************************************
changed: [client2-nodeexporters]
changed: [client1-nodeexporters]

TASK [../roles/client : Check data on client] ***********************************************************************************************************************************
ok: [client1-nodeexporters]
ok: [client2-nodeexporters]

TASK [../roles/client : Check data on client] ***********************************************************************************************************************************
skipping: [client1-nodeexporters]
skipping: [client2-nodeexporters]

TASK [../roles/client : Show data on client] ************************************************************************************************************************************
ok: [client1-nodeexporters] => {
    "msg": {
        "changed": false,
        "connection": "close",
        "content_length": "961",
        "content_type": "text/html; charset=UTF-8",
        "cookies": {},
        "cookies_string": "",
        "date": "Sun, 17 Sep 2023 15:19:11 GMT",
        "elapsed": 0,
        "failed": false,
        "msg": "OK (961 bytes)",
        "redirected": false,
        "status": 200,
        "url": "http://localhost:9100"
    }
}
ok: [client2-nodeexporters] => {
    "msg": {
        "changed": false,
        "connection": "close",
        "content_length": "961",
        "content_type": "text/html; charset=UTF-8",
        "cookies": {},
        "cookies_string": "",
        "date": "Sun, 17 Sep 2023 15:19:11 GMT",
        "elapsed": 0,
        "failed": false,
        "msg": "OK (961 bytes)",
        "redirected": false,
        "status": 200,
        "url": "http://localhost:9100"
    }
}

RUNNING HANDLER [../roles/client : systemctl daemon reload] *********************************************************************************************************************
ok: [client2-nodeexporters]
ok: [client1-nodeexporters]

PLAY RECAP **********************************************************************************************************************************************************************
client1-nodeexporters      : ok=13   changed=8    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   
client2-nodeexporters      : ok=13   changed=8    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   


PLAY [Playbook of server configure after clent initialization] ******************************************************************************************************************

TASK [Gathering Facts] **********************************************************************************************************************************************************
ok: [server-prometheus]

TASK [../roles/updateserversnode : Register content] ****************************************************************************************************************************
changed: [server-prometheus]

TASK [../roles/updateserversnode : Update prometheus.yml] ***********************************************************************************************************************
changed: [server-prometheus]

TASK [../roles/updateserversnode : Update prometheus.yml] ***********************************************************************************************************************
changed: [server-prometheus]

RUNNING HANDLER [../roles/updateserversnode : service restart prometheus] *******************************************************************************************************
changed: [server-prometheus]

PLAY RECAP **********************************************************************************************************************************************************************
server-prometheus          : ok=5    changed=4    unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   



</details>


Ğ’ Ñ€ĞµĞ·ÑƒĞ»ÑŒÑ‚Ğ°Ñ‚Ğµ Ğ¿Ğ¾Ğ»ÑƒÑ‡Ğ°ĞµĞ¼ Ğ½Ğ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ğ½Ñ‹Ğ¹ ÑÑ‚ĞµĞ½Ğ´ Ñ ÑĞµÑ€Ğ²ĞµÑ€Ğ¾Ğ¼ Prometheus/Grafana, Ğ´Ğ²ÑƒĞ¼Ñ Ğ½Ğ¾Ğ´Ğ°Ğ¼Ğ¸ ÑĞºÑĞ¿Ğ¾Ñ€Ñ‚ĞµÑ€Ğ°Ğ¼Ğ¸ Ğ´Ğ»Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ°


```shell

sincere@sincere-ubuntuotus:~/vagrantdocs$ tree lesson21
lesson21
â”œâ”€â”€ ansible
â”‚Â Â  â”œâ”€â”€ ansible.cfg
â”‚Â Â  â”œâ”€â”€ inventories
â”‚Â Â  â”‚Â Â  â””â”€â”€ hosts
â”‚Â Â  â”œâ”€â”€ playbooks
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ client.yml
â”‚Â Â  â”‚Â Â  â”œâ”€â”€ server.yml
â”‚Â Â  â”‚Â Â  â””â”€â”€ updateserversnode.yml
â”‚Â Â  â””â”€â”€ roles
â”‚Â Â      â”œâ”€â”€ client
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ files
â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ etc
â”‚Â Â      â”‚Â Â  â”‚Â Â      â”œâ”€â”€ systemd
â”‚Â Â      â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ system
â”‚Â Â      â”‚Â Â  â”‚Â Â      â”‚Â Â      â””â”€â”€ node_exporter.service
â”‚Â Â      â”‚Â Â  â”‚Â Â      â””â”€â”€ updatereposcript.sh
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ handlers
â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ main.yml
â”‚Â Â      â”‚Â Â  â””â”€â”€ tasks
â”‚Â Â      â”‚Â Â      â””â”€â”€ main.yml
â”‚Â Â      â”œâ”€â”€ server
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ files
â”‚Â Â      â”‚Â Â  â”‚Â Â  â”œâ”€â”€ dashboard
â”‚Â Â      â”‚Â Â  â”‚Â Â  â”‚Â Â  â””â”€â”€ overview.html
â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ etc
â”‚Â Â      â”‚Â Â  â”‚Â Â      â”œâ”€â”€ createpromfoldersandperm.sh
â”‚Â Â      â”‚Â Â  â”‚Â Â      â”œâ”€â”€ grafana
â”‚Â Â      â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ grafana.repo
â”‚Â Â      â”‚Â Â  â”‚Â Â      â”œâ”€â”€ prometheus
â”‚Â Â      â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ prometheus.yml
â”‚Â Â      â”‚Â Â  â”‚Â Â      â”œâ”€â”€ systemd
â”‚Â Â      â”‚Â Â  â”‚Â Â      â”‚Â Â  â””â”€â”€ system
â”‚Â Â      â”‚Â Â  â”‚Â Â      â”‚Â Â      â””â”€â”€ prometheus.service
â”‚Â Â      â”‚Â Â  â”‚Â Â      â””â”€â”€ updatereposcript.sh
â”‚Â Â      â”‚Â Â  â”œâ”€â”€ handlers
â”‚Â Â      â”‚Â Â  â”‚Â Â  â””â”€â”€ main.yml
â”‚Â Â      â”‚Â Â  â””â”€â”€ tasks
â”‚Â Â      â”‚Â Â      â””â”€â”€ main.yml
â”‚Â Â      â””â”€â”€ updateserversnode
â”‚Â Â          â”œâ”€â”€ handlers
â”‚Â Â          â”‚Â Â  â””â”€â”€ main.yml
â”‚Â Â          â””â”€â”€ tasks
â”‚Â Â              â””â”€â”€ main.yml
â”œâ”€â”€ img
â”‚Â Â  â”œâ”€â”€ screencast.gif
â”‚Â Â  â””â”€â”€ screenshot.png
â”œâ”€â”€ main.sh
â”œâ”€â”€ promgrafanaexport.log
â”œâ”€â”€ README.MD
â””â”€â”€ vm
    â””â”€â”€ Vagrantfile


```






