## Lesson27  - Network

Vagrantfile - для стенда урока 9 - Network

# Дано

https://github.com/erlong15/otus-linux/tree/network
(ветка network)

Метоличка новая тут https://docs.google.com/document/d/1rQH5M2MYclBkvmv3SO4wl4F_IErcojl86hD10ric6Lk/edit

2. Построить следующую сетевую архитектуру:
Сеть office1
- 192.168.2.0/26      - dev
- 192.168.2.64/26     - test servers
- 192.168.2.128/26    - managers
- 192.168.2.192/26    - office hardware

Сеть office2
- 192.168.1.0/25      - dev
- 192.168.1.128/26    - test servers
- 192.168.1.192/26    - office hardware

Сеть central
- 192.168.0.0/28     - directors
- 192.168.0.32/28    - office hardware
- 192.168.0.64/26    - wifi


```text
Office1 ---\
            -----> Central --IRouter --> internet
Office2 ---/
```

Итого должны получиться следующие сервера:
inetRouter
centralRouter
office1Router
office2Router
centralServer
office1Server
office2Server




## Теоретическая часть

    Найти свободные подсети
    Посчитать сколько узлов в каждой подсети, включая свободные
    Указать broadcast адрес для каждой подсети, проверить нет ли ошибок при разбиении.
    
## Практическая часть
    Соединить офисы в сеть согласно схеме и настроить роутинг
    Все сервера и роутеры должны ходить в инет черз inetRouter
    Все сервера должны видеть друг друга
    у всех новых серверов отключить дефолт на нат (eth0), который вагрант поднимает для связи
    при нехватке сетевых интервейсов добавить по несколько адресов на интерфейс

## Формат сдачи ДЗ - vagrant + ansible


# Выполнение


## Теоретическая часть


Таким образом мы можем сформировать таблицу топологии нашей сети


Принадлежность сети| Диапазон подсети | Наименование | Кол-во IP-адресов | Первый адрес в сети  | Последний адрес в сети | Broadcast адрес
Сеть office1 | 192.168.2.0/26 | dev | 62 | 192.168.2.1 | 192.168.2.62 | 192.168.2.63
Сеть office1 | 192.168.2.64/26 | test servers | 62 | 192.168.2.65 | 192.168.2.126 | 192.168.2.127
Сеть office1 | 192.168.2.128/26 | managers | 62 | 192.168.2.129 | 192.168.2.190 | 192.168.2.191
Сеть office1 | 192.168.2.192/26 | office hardware | 62 | 192.168.2.193 | 192.168.2.254 | 192.168.2.255

Сеть office2 | 192.168.1.0/25 | dev | 126 | 192.168.1.1 | 192.168.1.126 | 192.168.1.127
Сеть office2 | 192.168.1.128/26 | test servers | 62 | 192.168.1.129 | 192.168.1.190 | 192.168.1.191
Сеть office2 | 192.168.1.192/26 | office hardware | 62 | 192.168.1.193 | 192.168.1.253 | 192.168.1.254


Сеть central | 192.168.0.0/28 | directors | 14 | 192.168.0.1 | 192.168.0.14 | 192.168.0.15
Сеть central | 192.168.0.32/28 | office hardware | 14 | 192.168.0.33 | 192.168.0.62 | 192.168.0.63
Сеть central | 192.168.0.64/26 | wifi | 62 | 192.168.0.65 | 192.168.0.126 | 192.168.0.127

Неопределенные сети в подсети 192.168.0.0/24

192.168.0.16/28, 192.168.0.128/25, 192.168.0.48/28

Вывод: подсети не пересекаются, маршрутизируемы.

Недостающие сети
Сеть в интернет

Inet — central Router
192.168.255.1/30 - 192.168.255.2/30
192.168.255.0/30 255.255.255.252 2 192.168.255.1 192.168.255.2 192.168.255.3

Сети для связывания офисов 

В методичке конечно стоило бы выделить итли подсеть для серверов и роутеров или связывать сети через подсети для office hardware.
но в целом решил от методички далеко не отступать и считать что связывание происходит через внешние сети (Интернет)

Central Router <-> office1router 
192.168.255.9/30 - 192.168.255.10/30

Central Router <-> office2router 
192.168.255.5/30 - 192.168.255.6/30

## Практическая часть

Наши серверы в общем тоже находятся в подсетях для этого не предназначенных, но ТЗ есть ТЗ


centralServer - 192.168.0.2/28
office1Server - 192.168.2.130/26
office2Server - 192.168.1.0/25

Пропустим промежуточные уровни, сразу напишем Vagrantfile c нужным количеством машин и интерфейсами

Все серверы и роутеры будут на debian11/bullseye64. Основания так и в продакшн значительно удобнее, поддерживать зоопарк ОС немного тяжеловато.




